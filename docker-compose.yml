version: '2'

volumes:
    jenkins_home:
        external: true

# The build-args have default values that will be used if unspecified. 
services:

  jenkins:
    container_name: jenkins
    image: jenkins/jenkins:lts-jdk11
    ports:
      - 8080:8080
    volumes:
      - jenkins_home:/var/jenkins_home

  socat:
      container_name: socat
      image: alpine/socat
      ports:
        - 2376:2375
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
      command: tcp-listen:2375,fork,reuseaddr unix-connect:/var/run/docker.sock

  vault-server:
    container_name: vault-dev
    image: vault:latest
    ports:
      - "8200:8200"
    environment:
      VAULT_ADDR: "http://0.0.0.0:8200"
      VAULT_DEV_ROOT_TOKEN_ID: "vault-plaintext-root-token"
    cap_add:
      - IPC_LOCK
